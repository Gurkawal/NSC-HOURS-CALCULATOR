<!DOCTYPE html><html>
<head>
  <meta charset="UTF-8">
  <title>NSC Service Hours Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f0f0f0; padding: 20px; }
    h1 { color: #333; }
    label, input { display: block; margin: 5px 0; }
    input[type="text"] { padding: 5px; width: 150px; }
    button { margin-top: 10px; padding: 10px 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background-color: #ddd; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>
  <h1>NSC Service Hours Calculator</h1>
  <form id="nscForm">
    <label>Shift 1 Start (e.g., 0500): <input type="text" id="shift1Start"></label>
    <label>Shift 1 End (e.g., 1300): <input type="text" id="shift1End"></label>
    <button type="submit">Submit Day</button>
  </form>
  <button onclick="downloadPDF()">Download PDF</button>
  <table id="results">
    <thead>
      <tr>
        <th>Day</th>
        <th>Shift 1</th>
        <th>Duty Hours</th>
        <th>Off-Duty Hours</th>
        <th>NSC Violation</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>  <script>
    let log = [];
    let lastDayEnd = null;
    let baseDay = 0;

    function timeToMinutes(timeStr) {
      if (!timeStr) return null;
      let time = parseInt(timeStr);
      let hour = Math.floor(time / 100);
      let minute = time % 100;
      return hour * 60 + minute;
    }

    function minutesToHours(mins) {
      return (mins / 60).toFixed(2);
    }

    function duration(start, end) {
      if (!start || !end) return 0;
      let s = timeToMinutes(start);
      let e = timeToMinutes(end);
      if (e < s) e += 1440;
      return e - s;
    }

    document.getElementById('nscForm').addEventListener('submit', function(event) {
      event.preventDefault();

      const s1s = document.getElementById('shift1Start').value;
      const s1e = document.getElementById('shift1End').value;

      const dutyMins = duration(s1s, s1e);
      let offDuty = lastDayEnd !== null ? timeToMinutes(s1s) - lastDayEnd : 1440;
      if (offDuty < 0) offDuty += 1440;

      const violation = offDuty < 480 && lastDayEnd !== null ? 'Off-duty <8h' : 'None';

      const newEntry = {
        day: ++baseDay,
        shift1: `${s1s} to ${s1e} (${minutesToHours(dutyMins)}h)`,
        duty: `${minutesToHours(dutyMins)}h`,
        off: `${minutesToHours(offDuty)}h`,
        violation: violation
      };

      log.push(newEntry);
      lastDayEnd = timeToMinutes(s1e);

      renderTable();
      document.getElementById('nscForm').reset();
    });

    function renderTable() {
      const tbody = document.querySelector('#results tbody');
      tbody.innerHTML = '';
      log.forEach((entry, index) => {
        const row = `<tr>
          <td>${entry.day}</td>
          <td>${entry.shift1}</td>
          <td>${entry.duty}</td>
          <td>${entry.off}</td>
          <td>${entry.violation}</td>
        </tr>`;
        tbody.insertAdjacentHTML('beforeend', row);
      });
    }

    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const table = document.getElementById("results");
      const canvas = await html2canvas(table);
      const imgData = canvas.toDataURL("image/png");
      const pdfWidth = doc.internal.pageSize.getWidth();
      const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
      doc.text("NSC Service Hours Log", 10, 10);
      doc.addImage(imgData, "PNG", 10, 20, pdfWidth - 20, pdfHeight);
      doc.save("NSC_Service_Hours.pdf");
    }
  </script></body>
</html>
