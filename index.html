<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NSC Service Hours Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      padding: 20px;
    }
    h2 {
      font-size: 20px;
    }
    input {
      margin: 5px;
      padding: 5px;
      width: 200px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
    }
    th, td {
      border: 1px solid #888;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #ddd;
    }
    button {
      margin: 10px 5px;
      padding: 10px 15px;
    }
  </style>
</head>
<body>

<h2>NSC Service Hours Calculator</h2>

<div>
  <input id="shift1Start" placeholder="Shift 1 Start (e.g., 0500)">
  <input id="shift1End" placeholder="Shift 1 End (e.g., 1300)">
  <input id="shift2Start" placeholder="Shift 2 Start (optional)">
  <input id="shift2End" placeholder="Shift 2 End (optional)">
  <input id="overtimeBefore" placeholder="Overtime Before Shift 1 (optional)">
  <input id="overtimeBetween" placeholder="Overtime Between Shifts (optional)">
  <input id="overtimeAfter" placeholder="Overtime After Shift 2 (optional)">
</div>

<button onclick="submitDay()">Submit Day</button>
<button onclick="downloadPDF()">Download PDF</button>

<table id="resultTable">
  <thead>
    <tr>
      <th>Day</th>
      <th>Shift 1 Hours</th>
      <th>Shift 2 Hours</th>
      <th>Split Hours</th>
      <th>Overtime Total</th>
      <th>Total Duty Hours</th>
      <th>TET</th>
      <th>Off-Duty Hours</th>
      <th>NSC Violation</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let dayCounter = 1;
let previousEndTime = null;

function parseTime(time) {
  if (!time) return null;
  time = time.padStart(4, '0');
  const h = parseInt(time.substring(0, 2), 10);
  const m = parseInt(time.substring(2, 4), 10);
  return h + m / 60;
}

function toFixedH(num) {
  return num ? num.toFixed(2) : "0.00";
}

function submitDay() {
  const s1Start = parseTime(document.getElementById('shift1Start').value);
  const s1End = parseTime(document.getElementById('shift1End').value);
  const s2Start = parseTime(document.getElementById('shift2Start').value);
  const s2End = parseTime(document.getElementById('shift2End').value);
  const overtimeBefore = parseFloat(document.getElementById('overtimeBefore').value) || 0;
  const overtimeBetween = parseFloat(document.getElementById('overtimeBetween').value) || 0;
  const overtimeAfter = parseFloat(document.getElementById('overtimeAfter').value) || 0;

  const shift1Hours = s1End && s1Start ? s1End - s1Start : 0;
  const shift2Hours = s2End && s2Start ? s2End - s2Start : 0;
  const splitHours = s2Start && s1End ? Math.max(0, s2Start - s1End) : 0;
  const totalOvertime = overtimeBefore + overtimeBetween + overtimeAfter;
  const totalDuty = shift1Hours + shift2Hours + totalOvertime;
  const tet = shift1Hours + shift2Hours;
  const totalDutyWithBreaks = totalDuty + splitHours;

  let offDuty = 24;
  let violation = "None";

  if (previousEndTime !== null && s1Start !== null) {
    let gap = s1Start - previousEndTime;
    if (gap < 0) gap += 24;
    offDuty = gap;
    if (offDuty < 8) violation = "Off-duty <8h";
  }

  if (totalDutyWithBreaks > 14) violation = "Over 14h duty";
  if (tet > 13) violation = "Over 13h TET";

  const tbody = document.querySelector("#resultTable tbody");
  const row = document.createElement("tr");
  row.innerHTML = `
    <td>${dayCounter++}</td>
    <td>${toFixedH(shift1Hours)}</td>
    <td>${toFixedH(shift2Hours)}</td>
    <td>${toFixedH(splitHours)}</td>
    <td>${toFixedH(totalOvertime)}</td>
    <td>${toFixedH(totalDutyWithBreaks)}</td>
    <td>${toFixedH(tet)}</td>
    <td>${toFixedH(offDuty)}</td>
    <td>${violation}</td>
  `;
  tbody.appendChild(row);

  previousEndTime = s2End || s1End || 0;

  // Clear inputs
  document.querySelectorAll("input").forEach(i => i.value = "");
}

function downloadPDF() {
  alert("PDF download not implemented in this version.");
}
</script>

</body>
</html>
