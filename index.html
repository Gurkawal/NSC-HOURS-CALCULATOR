<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NSC Duty Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f2f5; }
    h1 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #e0e0e0; }
    input, button, select { padding: 5px; margin: 5px; }
    .delete-btn { color: red; cursor: pointer; }
    .flex-row { display: flex; flex-wrap: wrap; gap: 10px; }
    .flex-row label { display: flex; flex-direction: column; }
  </style>
</head>
<body>
<h1>NSC Daily Duty Tracker</h1><div class="flex-row">
  <label>Date<input type="date" id="date" /></label>
  <label>Shift 1 Start<input type="time" id="shift1Start" /></label>
  <label>Shift 1 End<input type="time" id="shift1End" /></label>
  <label>Shift 2 Start<input type="time" id="shift2Start" /></label>
  <label>Shift 2 End<input type="time" id="shift2End" /></label>
</div>
<button onclick="addEntry()">Submit</button><table id="resultTable">
  <thead>
    <tr>
      <th>Day</th>
      <th>Date</th>
      <th>Shift 1</th>
      <th>Shift 2</th>
      <th>Split Hours</th>
      <th>Overtime (Before / Between / After)</th>
      <th>Total Duty</th>
      <th>Cumulative Duty</th>
      <th>TET</th>
      <th>Off-Duty</th>
      <th>NSC Violation</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table><script>
let entries = [];
let cumulativeDuty = 0;

function parseTime(t) {
  if (!t) return null;
  const [h, m] = t.split(":").map(Number);
  return h + m / 60;
}

function formatTime(h) {
  const hour = Math.floor(h % 24);
  const min = Math.round((h % 1) * 60);
  const ampm = hour >= 12 ? "PM" : "AM";
  const h12 = hour % 12 === 0 ? 12 : hour % 12;
  return `${h12}:${min.toString().padStart(2, "0")} ${ampm}`;
}

function formatRange(start, end) {
  return `${formatTime(start)} to ${formatTime(end)} (${(end - start).toFixed(2)}h)`;
}

function addEntry() {
  const date = document.getElementById("date").value;
  const s1s = parseTime(document.getElementById("shift1Start").value);
  const s1e = parseTime(document.getElementById("shift1End").value);
  const s2s = parseTime(document.getElementById("shift2Start").value);
  const s2e = parseTime(document.getElementById("shift2End").value);

  if (!date || s1s == null || s1e == null) return alert("Enter at least Shift 1 and date.");

  let shift1Duration = s1e - s1s;
  let shift2Duration = s2s != null && s2e != null ? s2e - s2s : 0;
  if (shift2Duration < 0) shift2Duration += 24;
  if (shift1Duration < 0) shift1Duration += 24;

  let split = s2s != null ? s2s - s1e : 0;
  if (split < 0) split += 24;

  const totalDuty = shift1Duration + shift2Duration;
  cumulativeDuty += totalDuty;
  const TET = totalDuty + split;

  let offDuty = 24;
  if (entries.length > 0) {
    const prev = entries[entries.length - 1];
    const prevEnd = prev.s2e ? prev.s2e : prev.s1e;
    let endTime = prevEnd;
    if (new Date(date) > new Date(prev.date)) endTime -= 24; // if next day, compensate clock
    offDuty = s1s - endTime;
    if (offDuty < 0) offDuty += 24;
  }

  const violation = offDuty < 8 ? "Off-duty <8h" : "None";

  const entry = {
    day: entries.length + 1,
    date,
    s1: formatRange(s1s, s1e),
    s2: s2s != null && s2e != null ? formatRange(s2s, s2e) : "-",
    split: s2s != null ? `${split.toFixed(2)}h` : "0.00h",
    overtime: "0.00 / 0.00 / 0.00 h",
    total: `${totalDuty.toFixed(2)}h`,
    cumulative: `${cumulativeDuty.toFixed(2)}h`,
    tet: `${TET.toFixed(2)}h`,
    offDuty: `${offDuty.toFixed(2)}h`,
    violation,
    s1e, s2e: s2e || null
  };

  entries.push(entry);
  renderTable();
  document.querySelectorAll("input[type='time'], input[type='date']").forEach(e => e.value = "");
}

function renderTable() {
  const tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = "";
  entries.forEach((e, i) => {
    const row = `<tr>
      <td>${e.day}</td>
      <td>${e.date}</td>
      <td>${e.s1}</td>
      <td>${e.s2}</td>
      <td>${e.split}</td>
      <td>${e.overtime}</td>
      <td>${e.total}</td>
      <td>${e.cumulative}</td>
      <td>${e.tet}</td>
      <td>${e.offDuty}</td>
      <td>${e.violation}</td>
      <td><span class="delete-btn" onclick="deleteRow(${i})">Delete</span></td>
    </tr>`;
    tbody.insertAdjacentHTML("beforeend", row);
  });
}

function deleteRow(index) {
  cumulativeDuty -= parseFloat(entries[index].total);
  entries.splice(index, 1);
  entries.forEach((e, i) => e.day = i + 1);
  renderTable();
}
</script></body>
</html>
