<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NSC Compliance Tracker</title>
  <style>
    body { font-family: sans-serif; padding: 1em; }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    input[type="time"] { width: 100px; }
    .error { color: red; font-weight: bold; }
    .btn { padding: 0.5em 1em; margin-top: 1em; }
  </style>
</head>
<body>
  <h2>NSC Compliance Shift Tracker</h2>
  <form id="shiftForm">
    <label>Shift 1 Start: <input type="time" id="shift1Start" required></label>
    <label>Shift 1 End: <input type="time" id="shift1End" required></label><br><br>
    <label>Shift 2 Start: <input type="time" id="shift2Start"></label>
    <label>Shift 2 End: <input type="time" id="shift2End"></label><br><br>
    <button class="btn" type="submit">Submit Day</button>
  </form>  <table id="results">
    <thead>
      <tr>
        <th>Day</th>
        <th>Shift 1</th>
        <th>Shift 2</th>
        <th>Split Hours</th>
        <th>Overtime (Before / Between / After)</th>
        <th>Total Duty</th>
        <th>TET</th>
        <th>Off-Duty</th>
        <th>NSC Violation</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>  <script>
    const form = document.getElementById('shiftForm');
    const results = document.querySelector('#results tbody');

    let days = [];
    let previousDayEnd = null;

    function timeToMinutes(timeStr) {
      const [h, m] = timeStr.split(':').map(Number);
      return h * 60 + m;
    }

    function minutesToTime(mins) {
      const h = Math.floor(mins / 60);
      const m = mins % 60;
      return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
    }

    function minutesToHM(mins) {
      return (mins / 60).toFixed(2) + 'h';
    }

    function addRow(data) {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${data.day}</td>
        <td>${data.shift1}</td>
        <td>${data.shift2 || '-'}</td>
        <td>${data.split}</td>
        <td>${data.overtime}</td>
        <td>${data.totalDuty}</td>
        <td>${data.tet}</td>
        <td>${data.offDuty}</td>
        <td>${data.violation}</td>
        <td><button onclick="deleteDay(${data.day})">Delete</button></td>
      `;
      results.appendChild(row);
    }

    function deleteDay(dayNum) {
      days = days.filter(d => d.day !== dayNum);
      renderTable();
      previousDayEnd = null;
      for (const d of days) {
        const end = d.rawEnd;
        if (previousDayEnd === null || end > previousDayEnd) previousDayEnd = end;
      }
    }

    function renderTable() {
      results.innerHTML = '';
      days.forEach(addRow);
    }

    form.addEventListener('submit', e => {
      e.preventDefault();

      const s1Start = shift1Start.value;
      const s1End = shift1End.value;
      const s2Start = shift2Start.value;
      const s2End = shift2End.value;

      let s1StartMin = timeToMinutes(s1Start);
      let s1EndMin = timeToMinutes(s1End);
      if (s1EndMin < s1StartMin) s1EndMin += 1440;
      const s1Dur = s1EndMin - s1StartMin;

      let s2Dur = 0;
      let s2StartMin = 0;
      let s2EndMin = 0;
      let splitTime = 0;
      let s2Str = '';

      if (s2Start && s2End) {
        s2StartMin = timeToMinutes(s2Start);
        s2EndMin = timeToMinutes(s2End);
        if (s2EndMin < s2StartMin) s2EndMin += 1440;
        if (s2StartMin < s1EndMin) s2StartMin += 1440;
        if (s2EndMin < s2StartMin) s2EndMin += 1440;
        splitTime = s2StartMin - s1EndMin;
        s2Dur = s2EndMin - s2StartMin;
        s2Str = `${s2Start} to ${s2End} (${minutesToHM(s2Dur)})`;
      }

      const totalDuty = s1Dur + s2Dur;
      const tet = totalDuty + splitTime;

      let offDuty = 0;
      let startMin = s1StartMin;
      if (previousDayEnd !== null) {
        while (startMin <= previousDayEnd) {
          startMin += 1440;
        }
        offDuty = startMin - previousDayEnd;
      }

      let violation = 'None';
      if (tet > 840 || totalDuty > 840 || days.reduce((sum, d) => sum + d.totalDutyMin, 0) + totalDuty > 4200) {
        violation = 'NSC Limit Exceeded';
      } else if (offDuty < 480) {
        violation = 'Off-duty <8h';
      }

      const day = days.length + 1;
      const rowData = {
        day,
        shift1: `${s1Start} to ${s1End} (${minutesToHM(s1Dur)})`,
        shift2: s2Str,
        split: minutesToHM(splitTime),
        overtime: '0.00 / 0.00 / 0.00 h',
        totalDuty: minutesToHM(totalDuty),
        tet: minutesToHM(tet),
        offDuty: minutesToHM(offDuty),
        violation,
        totalDutyMin: totalDuty,
        rawEnd: s2End ? s2EndMin : s1EndMin
      };

      days.push(rowData);
      previousDayEnd = rowData.rawEnd;
      renderTable();
      form.reset();
    });
  </script></body>
</html>
