<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NSC Service Hours Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #eee;
    }
    input {
      margin: 5px 0;
      width: 100%;
      padding: 6px;
    }
    button {
      padding: 10px 15px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2>NSC Service Hours Calculator</h2>
  <label>Date (YYYY-MM-DD): <input type="date" id="date"></label><br>
  <label>Shift 1 Start (e.g., 0500): <input id="shift1Start"></label><br>
  <label>Shift 1 End (e.g., 1300): <input id="shift1End"></label><br>
  <label>Shift 2 Start (optional): <input id="shift2Start"></label><br>
  <label>Shift 2 End (optional): <input id="shift2End"></label><br>
  <label>Overtime Before Shift 1 (optional): <input id="otBefore"></label><br>
  <label>Overtime Between Shifts (optional): <input id="otBetween"></label><br>
  <label>Overtime After Shift 2 (optional): <input id="otAfter"></label><br>
  <button onclick="submitDay()">Submit Day</button>
  <table id="resultTable">
    <thead>
      <tr>
        <th>Day</th>
        <th>Date</th>
        <th>Shift 1</th>
        <th>Shift 2</th>
        <th>Split Hours</th>
        <th>Overtime (Before / Between / After)</th>
        <th>Total Duty</th>
        <th>TET</th>
        <th>Off-Duty</th>
        <th>NSC Violation</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="logBody"></tbody>
  </table>  <script>
    let logs = [];

    function toMinutes(hhmm) {
      const h = parseInt(hhmm.slice(0, -2));
      const m = parseInt(hhmm.slice(-2));
      return h * 60 + m;
    }

    function formatTime(m) {
      const h = Math.floor(m / 60);
      const min = m % 60;
      const suffix = h >= 12 ? 'PM' : 'AM';
      const stdH = ((h + 11) % 12 + 1);
      return `${stdH}:${min.toString().padStart(2, '0')} ${suffix}`;
    }

    function formatShift(start, end) {
      const sMin = toMinutes(start);
      const eMin = toMinutes(end);
      const dur = (eMin >= sMin ? eMin - sMin : eMin + 1440 - sMin) / 60;
      return `${formatTime(sMin)} to ${formatTime(eMin)} (${dur.toFixed(2)}h)`;
    }

    function calcDuration(start, end) {
      const sMin = toMinutes(start);
      const eMin = toMinutes(end);
      return (eMin >= sMin ? eMin - sMin : eMin + 1440 - sMin) / 60;
    }

    function submitDay() {
      const date = document.getElementById("date").value;
      const s1Start = document.getElementById("shift1Start").value;
      const s1End = document.getElementById("shift1End").value;
      const s2Start = document.getElementById("shift2Start").value;
      const s2End = document.getElementById("shift2End").value;
      const otBefore = parseFloat(document.getElementById("otBefore").value) || 0;
      const otBetween = parseFloat(document.getElementById("otBetween").value) || 0;
      const otAfter = parseFloat(document.getElementById("otAfter").value) || 0;

      if (!date || !s1Start || !s1End) return alert("Please enter date and shift 1 start/end");

      const shift1Dur = calcDuration(s1Start, s1End);
      let shift2Dur = 0;
      let splitHours = 0;
      let shift2Display = "-";

      if (s2Start && s2End) {
        shift2Dur = calcDuration(s2Start, s2End);
        splitHours = (toMinutes(s2Start) - toMinutes(s1End)) / 60;
        shift2Display = formatShift(s2Start, s2End);
      }

      const totalDuty = shift1Dur + shift2Dur + otBefore + otBetween + otAfter;
      const tet = shift1Dur + shift2Dur;

      let offDuty = 0;
      if (logs.length > 0) {
        const lastLog = logs[logs.length - 1];
        const prevEnd = new Date(`${lastLog.date}T00:00:00`);
        prevEnd.setMinutes(prevEnd.getMinutes() + lastLog.endMin);

        const currStart = new Date(`${date}T00:00:00`);
        currStart.setMinutes(currStart.getMinutes() + toMinutes(s1Start));

        offDuty = (currStart - prevEnd) / (1000 * 60 * 60);
      } else {
        offDuty = 24;
      }

      let violation = "None";
      if (totalDuty > 14) violation = "Over 14h duty";
      else if (tet > 13) violation = "Over 13h TET";
      else if (offDuty < 8) violation = "Off-duty <8h";

      const log = {
        day: logs.length + 1,
        date,
        shift1: formatShift(s1Start, s1End),
        shift2: shift2Display,
        split: splitHours.toFixed(2) + "h",
        overtime: `${otBefore.toFixed(2)} / ${otBetween.toFixed(2)} / ${otAfter.toFixed(2)} h`,
        totalDuty: totalDuty.toFixed(2) + "h",
        tet: tet.toFixed(2) + "h",
        offDuty: offDuty.toFixed(2) + "h",
        violation,
        endMin: toMinutes(s2End || s1End)
      };

      logs.push(log);
      renderTable();
    }

    function renderTable() {
      const tbody = document.getElementById("logBody");
      tbody.innerHTML = "";
      logs.forEach((log, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${log.day}</td>
          <td>${log.date}</td>
          <td>${log.shift1}</td>
          <td>${log.shift2}</td>
          <td>${log.split}</td>
          <td>${log.overtime}</td>
          <td>${log.totalDuty}</td>
          <td>${log.tet}</td>
          <td>${log.offDuty}</td>
          <td>${log.violation}</td>
          <td><button onclick="deleteRow(${i})">Delete</button></td>
        `;
        tbody.appendChild(row);
      });
    }

    function deleteRow(index) {
      logs.splice(index, 1);
      logs.forEach((log, i) => log.day = i + 1);
      renderTable();
    }
  </script></body>
</html>
