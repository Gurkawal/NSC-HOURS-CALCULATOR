<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NSC Compliance Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f8f9fa; }
    h1 { color: #333; }
    input[type="time"], button { margin: 4px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f1f1f1; }
    tr:nth-child(even) { background-color: #f9f9f9; }
    .violation { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>NSC Compliance Tracker</h1>
  <div>
    <label>Shift 1 Start: <input type="time" id="shift1Start"></label>
    <label>Shift 1 End: <input type="time" id="shift1End"></label>
    <br>
    <label>Shift 2 Start: <input type="time" id="shift2Start"></label>
    <label>Shift 2 End: <input type="time" id="shift2End"></label>
    <br>
    <button onclick="submitDay()">Submit Day</button>
    <button onclick="resetTracker()">Reset All</button>
  </div>
  <table id="results">
    <thead>
      <tr>
        <th>Day</th>
        <th>Shift 1</th>
        <th>Shift 2</th>
        <th>Split Hours</th>
        <th>Overtime (Before / Between / After)</th>
        <th>Total Duty</th>
        <th>TET</th>
        <th>Off-Duty</th>
        <th>NSC Violation</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="resultBody"></tbody>
  </table>  <script>
    let shifts = [];

    function toMinutes(timeStr) {
      const [h, m] = timeStr.split(":").map(Number);
      return h * 60 + m;
    }

    function formatTime(start, end) {
      const startMin = toMinutes(start);
      const endMin = toMinutes(end);
      const dur = ((endMin + 1440 - startMin) % 1440) / 60;
      return `${start} to ${end} (${dur.toFixed(2)}h)`;
    }

    function calcHours(start, end) {
      const s = toMinutes(start);
      const e = toMinutes(end);
      return ((e + 1440 - s) % 1440) / 60;
    }

    function submitDay() {
      const s1Start = document.getElementById("shift1Start").value;
      const s1End = document.getElementById("shift1End").value;
      const s2Start = document.getElementById("shift2Start").value;
      const s2End = document.getElementById("shift2End").value;

      if (!s1Start || !s1End) {
        alert("Shift 1 is required.");
        return;
      }

      let shift1Hours = calcHours(s1Start, s1End);
      let shift2Hours = s2Start && s2End ? calcHours(s2Start, s2End) : 0;
      let splitHours = s2Start ? calcHours(s1End, s2Start) : 0;
      let totalDuty = shift1Hours + shift2Hours;
      let tet = totalDuty + splitHours;

      let prev = shifts[shifts.length - 1];
      let prevEnd = prev ? prev.endTime : null;
      let currStart = s1Start;

      let offDuty = 24.0;
      let violation = "None";

      if (prevEnd) {
        let prevMinutes = toMinutes(prevEnd);
        let currMinutes = toMinutes(currStart);
        let offMin = (currMinutes + 1440 - prevMinutes) % 1440;
        if (offMin < 480) {
          violation = "Off-duty <8h";
        }
        offDuty = (offMin / 60).toFixed(2);
      }

      const newShift = {
        day: shifts.length + 1,
        shift1: formatTime(s1Start, s1End),
        shift2: s2Start && s2End ? formatTime(s2Start, s2End) : "-",
        split: splitHours.toFixed(2) + "h",
        overtime: "0.00 / 0.00 / 0.00 h",
        duty: totalDuty.toFixed(2) + "h",
        tet: tet.toFixed(2) + "h",
        offDuty: offDuty + "h",
        violation: violation,
        endTime: s2End || s1End
      };

      shifts.push(newShift);
      render();
      document.getElementById("shift1Start").value = "";
      document.getElementById("shift1End").value = "";
      document.getElementById("shift2Start").value = "";
      document.getElementById("shift2End").value = "";
    }

    function render() {
      const body = document.getElementById("resultBody");
      body.innerHTML = "";
      shifts.forEach((s, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${s.day}</td>
          <td>${s.shift1}</td>
          <td>${s.shift2}</td>
          <td>${s.split}</td>
          <td>${s.overtime}</td>
          <td>${s.duty}</td>
          <td>${s.tet}</td>
          <td>${s.offDuty}</td>
          <td class="${s.violation !== 'None' ? 'violation' : ''}">${s.violation}</td>
          <td><button onclick="deleteDay(${i})">Delete</button></td>
        `;
        body.appendChild(tr);
      });
    }

    function deleteDay(index) {
      shifts.splice(index, 1);
      shifts.forEach((s, i) => s.day = i + 1);
      render();
    }

    function resetTracker() {
      shifts = [];
      render();
    }
  </script></body>
</html>
