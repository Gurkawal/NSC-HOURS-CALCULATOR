<!DOCTYPE html><html>
<head>
  <meta charset="UTF-8">
  <title>NSC Service Hour Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f8f9fa; }
    h2 { margin-bottom: 10px; }
    input, button { margin: 5px; padding: 8px; width: 220px; }
    button { width: auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #e9ecef; }
  </style>
</head>
<body>
  <h2>NSC Service Hour Calculator</h2>
  <form id="serviceForm">
    <label>Shift 1 Start (e.g. 0500): <input type="text" id="shift1Start"></label><br>
    <label>Shift 1 End (e.g. 1300): <input type="text" id="shift1End"></label><br>
    <label>Shift 2 Start (optional): <input type="text" id="shift2Start"></label><br>
    <label>Shift 2 End (optional): <input type="text" id="shift2End"></label><br>
    <label>Overtime Before Shift 1: <input type="text" id="otBefore"></label><br>
    <label>Overtime Between Shifts: <input type="text" id="otBetween"></label><br>
    <label>Overtime After Shift 2: <input type="text" id="otAfter"></label><br>
    <button type="submit">Submit Day</button>
  </form>  <table id="resultTable">
    <tr>
      <th>Day</th>
      <th>Shift 1 Hours</th>
      <th>Shift 2 Hours</th>
      <th>Split Hours</th>
      <th>OT Total</th>
      <th>Total Duty</th>
      <th>TET</th>
      <th>Off Duty</th>
      <th>NSC Violation</th>
    </tr>
  </table>  <script>
    let previousEnd = null;
    let serviceDay = 0;
    let lastDayEnd = null;
    let total7DayWindow = [];

    function toMinutes(timeStr) {
      if (!timeStr) return null;
      let num = parseInt(timeStr);
      let hour = Math.floor(num / 100), min = num % 100;
      return hour * 60 + min;
    }

    function hoursBetween(start, end) {
      if (start === null || end === null) return 0;
      if (end < start) end += 1440;
      return (end - start) / 60;
    }

    document.getElementById("serviceForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const s1s = toMinutes(document.getElementById("shift1Start").value);
      const s1e = toMinutes(document.getElementById("shift1End").value);
      const s2s = toMinutes(document.getElementById("shift2Start").value);
      const s2e = toMinutes(document.getElementById("shift2End").value);

      const ot1 = toMinutes(document.getElementById("otBefore").value);
      const ot2 = toMinutes(document.getElementById("otBetween").value);
      const ot3 = toMinutes(document.getElementById("otAfter").value);

      const shift1Hrs = hoursBetween(s1s, s1e);
      const shift2Hrs = s2s && s2e ? hoursBetween(s2s, s2e) : 0;
      const splitHrs = s2s ? hoursBetween(s1e, s2s) : 0;

      const otHrs = hoursBetween(ot1, s1s) + hoursBetween(s1e, ot2) + hoursBetween(s2e || s1e, ot3);
      const totalDuty = shift1Hrs + shift2Hrs + otHrs;
      const tet = s2e ? hoursBetween(s1s, s2e) : shift1Hrs;

      let offDuty = 24;
      if (lastDayEnd !== null) {
        offDuty = hoursBetween(lastDayEnd, s1s);
      }

      if (lastDayEnd === null || offDuty >= 8) {
        serviceDay++;
      }

      lastDayEnd = s2e || s1e;
      total7DayWindow.push(totalDuty);
      if (total7DayWindow.length > 7) total7DayWindow.shift();
      const rolling7Total = total7DayWindow.reduce((a, b) => a + b, 0);

      let violations = [];
      if (totalDuty > 14) violations.push("Over 14h duty");
      if ((shift1Hrs + shift2Hrs) > 13) violations.push("Over 13h driving");
      if (tet > 16) violations.push("TET over 16h");
      if (offDuty < 8) violations.push("<8h off-duty");
      if (rolling7Total > 70) violations.push(">70h/7d");

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${serviceDay}</td>
        <td>${shift1Hrs.toFixed(2)}</td>
        <td>${shift2Hrs.toFixed(2)}</td>
        <td>${splitHrs.toFixed(2)}</td>
        <td>${otHrs.toFixed(2)}</td>
        <td>${totalDuty.toFixed(2)}</td>
        <td>${tet.toFixed(2)}</td>
        <td>${offDuty.toFixed(2)}</td>
        <td>${violations.length ? violations.join(", ") : "None"}</td>
      `;
      document.getElementById("resultTable").appendChild(row);
      document.getElementById("serviceForm").reset();
    });
  </script></body>
</html>
