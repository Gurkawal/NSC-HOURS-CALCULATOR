<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NSC Compliance Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 1rem;
    }
    label, input, button, select {
      margin: 0.2rem 0;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 0.5rem;
      text-align: center;
    }
    th {
      background-color: #f2f2f2;
    }
    .input-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <h2>NSC Compliance Tracker</h2>
  <div class="input-row">
    <label>Date: <input type="date" id="dateInput" /></label>
    <label>Shift 1 Start: <input type="time" id="shift1Start" /></label>
    <label>Shift 1 End: <input type="time" id="shift1End" /></label>
    <label>Shift 2 Start: <input type="time" id="shift2Start" /></label>
    <label>Shift 2 End: <input type="time" id="shift2End" /></label>
    <button onclick="submitShift()">Submit</button>
  </div>
  <table id="resultTable">
    <thead>
      <tr>
        <th>Day</th>
        <th>Date</th>
        <th>Shift 1</th>
        <th>Shift 2</th>
        <th>Split Hours</th>
        <th>Overtime (Before / Between / After)</th>
        <th>Total Duty</th>
        <th>Cumulative Duty</th>
        <th>TET</th>
        <th>Off-Duty</th>
        <th>NSC Violation</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="resultBody"></tbody>
  </table>  <script>
    let shifts = [];
    let cumulativeDuty = 0;

    function parseTimeToDecimal(timeStr) {
      const [hour, minute] = timeStr.split(":").map(Number);
      return hour + minute / 60;
    }

    function formatTimeDecimal(decimal) {
      const hour = Math.floor(decimal);
      const minute = Math.round((decimal - hour) * 60);
      const h = ((hour + 11) % 12 + 1);
      const ampm = hour >= 12 ? 'PM' : 'AM';
      return `${h}:${minute.toString().padStart(2, '0')} ${ampm}`;
    }

    function calculateNSCViolation(lastEnd, currentStart, sameDate) {
      if (!lastEnd) return "None";
      const diff = currentStart - lastEnd;
      if (!sameDate || diff >= 8) return "None";
      return "Off-duty <8h";
    }

    function submitShift() {
      const date = document.getElementById("dateInput").value;
      const s1Start = document.getElementById("shift1Start").value;
      const s1End = document.getElementById("shift1End").value;
      const s2Start = document.getElementById("shift2Start").value;
      const s2End = document.getElementById("shift2End").value;
      if (!date || !s1Start || !s1End) return alert("Please fill Shift 1 and date");

      const day = shifts.length + 1;
      const s1StartDec = parseTimeToDecimal(s1Start);
      const s1EndDec = parseTimeToDecimal(s1End);
      const s2StartDec = s2Start ? parseTimeToDecimal(s2Start) : null;
      const s2EndDec = s2End ? parseTimeToDecimal(s2End) : null;

      const shift1Duration = s1EndDec - s1StartDec;
      const shift2Duration = s2StartDec !== null && s2EndDec !== null ? s2EndDec - s2StartDec : 0;
      const totalDuty = shift1Duration + shift2Duration;
      const splitHours = s2StartDec !== null ? s2StartDec - s1EndDec : 0;

      cumulativeDuty += totalDuty;

      const shift1Str = `${formatTimeDecimal(s1StartDec)} to ${formatTimeDecimal(s1EndDec)} (${shift1Duration.toFixed(2)}h)`;
      const shift2Str = shift2Duration > 0 ? `${formatTimeDecimal(s2StartDec)} to ${formatTimeDecimal(s2EndDec)} (${shift2Duration.toFixed(2)}h)` : "-";

      const TETend = s2End ? s2EndDec : s1EndDec;

      const lastShift = shifts[shifts.length - 1];
      const lastEndTime = lastShift ? lastShift.TETend : null;
      const lastDate = lastShift ? lastShift.date : null;

      const sameDate = lastDate === date;
      const violation = calculateNSCViolation(lastEndTime, s1StartDec, sameDate);

      const entry = {
        day,
        date,
        shift1: shift1Str,
        shift2: shift2Str,
        split: splitHours.toFixed(2) + "h",
        overtime: "0.00 / 0.00 / 0.00 h",
        totalDuty: totalDuty.toFixed(2) + "h",
        cumulativeDuty: cumulativeDuty.toFixed(2) + "h",
        TET: TETend.toFixed(2) + "h",
        offDuty: lastEndTime !== null ? (s1StartDec - lastEndTime).toFixed(2) + "h" : "24.00h",
        violation,
        TETend
      };

      shifts.push(entry);
      updateTable();
    }

    function deleteShift(index) {
      shifts.splice(index, 1);
      // Recalculate everything
      cumulativeDuty = 0;
      shifts.forEach((shift, i) => {
        shift.day = i + 1;
        shift.cumulativeDuty = (cumulativeDuty + parseFloat(shift.totalDuty)).toFixed(2) + "h";
        cumulativeDuty += parseFloat(shift.totalDuty);
      });
      updateTable();
    }

    function updateTable() {
      const tbody = document.getElementById("resultBody");
      tbody.innerHTML = "";
      shifts.forEach((s, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${s.day}</td>
          <td>${s.date}</td>
          <td>${s.shift1}</td>
          <td>${s.shift2}</td>
          <td>${s.split}</td>
          <td>${s.overtime}</td>
          <td>${s.totalDuty}</td>
          <td>${s.cumulativeDuty}</td>
          <td>${s.TET}</td>
          <td>${s.offDuty}</td>
          <td>${s.violation}</td>
          <td><button onclick="deleteShift(${i})">Delete</button></td>
        `;
        tbody.appendChild(row);
      });
    }
  </script></body>
</html>
